<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CADASTRO - Mercoflux</title>
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <div class="header">
            <div class="container">
                <a href="index.html">
                    <img src="images/LogoF.png">
                </a>
                <ul class="navbar">
                    <li>
                        <a href="index.html">
                            HOME
                        </a>
                    </li>
                    <li>
                        <a href="projeto.html">
                            PROJETO
                        </a>
                    </li>
                    <li>
                        <a href="simulador.html">
                            SIMULADOR
                        </a>
                    </li>
                    <li  class="destaque">
                        <a href="cadastro.html">CADASTRO

                        </a>
                    </li>
                    <li>
                        <a href="login.html">
                            LOGIN
                        </a>
                    </li>
                </ul>
            </div>
        </div> <!--Div Header-->


        <div class="banner">
            <div class="container cont1">
                <div class="card" id="parte1">
                    Entre com o seu nome: <br>
                    <input type="text" placeholder="Entre com seu nome" id="nome" value="AgdaTan"><br>

                    Entre com o seu e-mail: <br>
                    <input type="text" placeholder="Entre com seu e-mail" id="email" value="daso@djsai"><br>

                    Entre com seu CPF: <br>
                    <input type="text" placeholder="111.111.111-11" id="cpf" value="123"> <br>

                    Entre com sua senha: <br>
                    <input type="password" placeholder="********" id="senha" value="1234"><br>

                    Confirme a sua senha: <br>
                    <input type="password" placeholder="********" id="confirmar" value="1234"> <br>

                    <button onclick="proximo()">Próximo</button>
                    <br>
                    <span class="alerta" id="alerta1"></span>
                    <br>
                </div>
                <div class="card" style="display: none;" id="parte2">
                    <center>
                        Entre com o nome do mercado: <br>
                        <input type="text" placeholder="Nome do mercado" id="nome_mercado" value="Opa"><br>

                        Entre o CNPJ do mercado: <br>
                        <input type="text" placeholder="Entre com seu CNPJ" id="cnpj" value="34"> <br>

                        Entre com o CEP do mercado: <br>
                        <input type="text" placeholder="44444-444" id="cep" value="123"><br>

                        Insira o estado: <br>
                        <select id="estado">
                            <option value="SP">SP</option>
                            <option value="">--Escolha o Estado--</option>
                            <option value="RJ">RJ</option>
                            <option value="ES">ES</option>
                            <option value="MG">MG</option>
                            <option value="PR">PR</option>
                            <option value="GO">GO</option>
                            <option value="SC">SC</option>
                            <option value="ES">ES</option>
                        </select> <br>

                        Insira a cidade: <br>
                        <input type="text" placeholder="São Paulo" id="cidade" value="djsaid"> <br>

                        Insira o logradouro: <br>
                        <input type="text" placeholder="Rua Augusta" id="logradouro" value="djsaid"> <br>

                        Insira o número (referente ao endereço): <br>
                        <input type="text" placeholder="235" id="numero" value="23"> <br>

                        Complemento: <br>
                        <input type="text" placeholder="3° andar" id="complemento" value="djsai"><br>

                        <button id="btn_cadastrar" onclick="cadastrar()" style="margin-top: 20px;">Cadastrar</button>

                        <br>
                        <span class="alerta" id="alerta2"></span>
                        <br>
                    </center> 
                </div>
            </div>
        </div> <!--Div Banner-->

        <div class="footer">
            <div class="alinhar">
                <div class="conteudo">
                    <div class="informacoes">
                        <h2>Institucional</h2>
                        <ul>
                            <li><a href="projeto.html" class="footera">Projeto</a></li>
                            <li><a href="simulador.html" class="footera">Simulador finaceiro</a></li>
                        </ul>
                    </div>
                    <div class="contato">
                        <h2>Contato</h2>
                        <ul>
                            <li>help@mercoflux.on.spiceworks.com</li>
                            <li><a href="https://mercoflux.on.spiceworks.com/portal" class="portal">Portal</a></li>
                            <li>2521-7316</li>
                        </ul>
                    </div>
                    <div class="conta">
                        <h2>Conta</h2>
                        <ul>
                            <li><a href="login.html" class="footera">Login</a></li>
                            <li><a href="cadastro.html" class="footera">Cadastro</a></li>
                        </ul>
                    </div>
                </div>
                <p>Todos os resultados técnicos e criativos são resultado do esforço do Grupo 7&copy; de CCO</p>
            </div>
        </div>
    </body>
</html>

<script>
    var nomeVar;
    var emailVar;
    var cpfVar;
    var senhaVar;
    var confirmarVar;

    function proximo(){
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        nomeVar = nome.value;
        emailVar = email.value;
        cpfVar = cpf.value;
        senhaVar = senha.value;
        confirmarVar = confirmar.value;

        // Verificação de campos vazios
        if(nomeVar == "" || emailVar == "" || cpfVar == "" || senhaVar == "" || confirmarVar == ""){
            alertar(alerta1, "Preencha todos os campos para prosseguir!");
        }

        // Verificação de tamanho dos campos
        else if(nomeVar.length < 5){
            alertar(alerta1, "O campo nome está muito pequeno! (Mínimo 5 caracteres)");
        }
        else if(nomeVar.length > 50){
            alertar(alerta1, "O campo nome está muito grande! (Máximo 50 caracteres)");
        }
        else if(emailVar.length < 3){
            alertar(alerta1, "O campo e-mail está muito pequeno! (Mínimo 3 caracteres)");
        }
        else if(emailVar.length > 50){
            alertar(alerta1, "O campo e-mail está muito grande! (Máximo 50 caracteres)");
        }
        else if(senhaVar.length < 4){
            alertar(alerta1, "O campo senha está muito pequeno! (Mínimo 4 caracteres)");
        }
        else if(senhaVar.length > 30){
            alertar(alerta1, "O campo senha está muito grande! (Máximo 30 caracteres)");
        }
        else if(cpfVar.length != 11){
            alertar(alerta1, "O campo CPF deve conter 11 números!");
        }

        // Verificação de tipos de campo
        else if(emailVar.indexOf("@") == -1){
            alertar(alerta1, "Ops, e-mail inválido! Verifique e tente novamente.");
        }
        else if(senhaVar != confirmarVar){
            alertar(alerta1, "As senhas inseridas devem ser iguais para prosseguir!");
        }
        else{
            parte1.style.display = "none";
            parte2.style.display = "block";
        }

        return false;
    }

    function cadastrar(){
        var nomeMercadoVar = nome_mercado.value;
        var cnpjVar = cnpj.value;
        var cepVar = cep.value;
        var estadoVar = estado.value;
        var cidadeVar = cidade.value;
        var logradouroVar = logradouro.value;
        var numeroVar = numero.value;
        var complementoVar = complemento.value;

        if(nomeMercadoVar == "" || cnpjVar == "" || cepVar == "" || estadoVar == "" || cidadeVar == "" || logradouroVar == "" || numeroVar == ""){
            alertar(alerta2, "Preencha todos os campos para prosseguir!");
        }
        else if(nomeMercadoVar.length > 50){
            alertar(alerta2, "O campo nome está muito grande! (Máximo 5 caracteres)");
        }
        else if(cnpjVar.length != 14){
            alertar(alerta2, "O campo cnpj deve conter 14 números!");
        }
        else if(cepVar.length != 8){
            alertar(alerta2, "O campo cep deve conter 8 números!");
        }
        else if(cidadeVar.length < 3){
            alertar(alerta2, "O campo cidade está muito pequeno! (Mínimo 3 caracteres)");
        }
        else if(cidadeVar.length > 50){
            alertar(alerta2, "O campo cidade está muito grande! (Máximo 3 caracteres)");
        }
        else if(logradouroVar.length < 5){
            alertar(alerta2, "O campo logradouro está muito pequeno! (Mínimo 5 caracteres)");
        }
        else if(logradouroVar.length > 50){
            alertar(alerta2, "O campo logradouro está muito grande! (Máximo 5 caracteres)");
        }
        else{
            btn_cadastrar.disabled = true;            

            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: nomeVar,
                    emailServer: emailVar,
                    cpfServer: cpfVar,
                    senhaServer: senhaVar,
                    nomeMercadoServer: nomeMercadoVar,
                    cnpjServer: cnpjVar,
                    cepServer: cepVar,
                    estadoServer: estadoVar,
                    cidadeServer: cidadeVar,
                    logradouroServer: logradouroVar,
                    numeroServer: numeroVar,
                    complementoServer: complementoVar
                })
            }).then(function (resposta){
    
                console.log("resposta: ", resposta);
    
                if (resposta.ok){
                    alertar(alerta2, "Cadastro realizado com sucesso!");
                    window.location = "login.html";
                } else {
                    alertar(alerta2, "Houve um erro ao tentar realizar o cadastro!");
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta){
                console.log(`#ERRO: ${resposta}`);
            });
    
        }
        
        return false;
    }

    function alertar(id_alerta, mensagem){
        id_alerta.style.display = "block";
        id_alerta.innerHTML = mensagem;
    }

    function removerAlerta(id_alerta){
        id_alerta.style.display = "none";
    }
</script>